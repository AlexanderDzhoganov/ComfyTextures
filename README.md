# Comfy Textures

## Installation

### Setup ComfyUI

1. Install [ComfyUI](https://github.com/comfyanonymous/ComfyUI) by following the [official installation instructions](https://github.com/comfyanonymous/ComfyUI?tab=readme-ov-file#installing) for your OS.

2. Download the necessary models and place them in the ComfyUI `models` directory.

The models directory is relative to the ComfyUI root directory i.e. `<ComfyUI Root>/ComfyUI/models/`.

- `models/checkpoints/sd_xl_base_1.0_0.9vae.safetensors` - [Download](https://huggingface.co/stabilityai/stable-diffusion-xl-base-1.0/blob/main/sd_xl_base_1.0_0.9vae.safetensors)
- `models/checkpoints/sd_xl_refiner_1.0_0.9vae.safetensors` - [Download](https://huggingface.co/stabilityai/stable-diffusion-xl-refiner-1.0/blob/main/sd_xl_refiner_1.0_0.9vae.safetensors)
- `models/controlnet/control-lora-canny-rank256.safetensors` - [Download](https://huggingface.co/stabilityai/control-lora/blob/main/control-LoRAs-rank256/control-lora-canny-rank256.safetensors)
- `models/controlnet/control-lora-depth-rank256.safetensors` - [Download](https://huggingface.co/stabilityai/control-lora/blob/main/control-LoRAs-rank256/control-lora-depth-rank256.safetensors)
- `models/loras/lcm_lora_sdxl.safetensors` - [Download](https://huggingface.co/latent-consistency/lcm-lora-sdxl/blob/main/pytorch_lora_weights.safetensors) (Note: Rename the file to `lcm_lora_sdxl.safetensors`)
- `models/upscale_models/4x-UltraSharp.pth` - [Download](https://huggingface.co/lokCX/4x-Ultrasharp/blob/main/4x-UltraSharp.pth)

### Setup Unreal Engine project

1. Clone this repository and open the project (`MyProject.uproject`) in the Unreal Engine editor.

2. Configure the plugin by going to `Project Settings -> Plugins -> Comfy Textures`.

Make sure to set `Comfy Dir` to the ComfyUI directory i.e. `<ComfyUI Root>/ComfyUI/`.

3. Open the plugin window by clicking on `Tools -> Editor Utility Widgets -> Comfy Textures Widget`.

Note: If the menu item is missing you need to open the `ComfyTexturesWidget` from the content browser in `Plugins/Comfy Textures Content/` and click `Run Utility Widget` in the blueprint editor.

## Usage

Note: Make sure ComfyUI is up and running before proceeding.

![Comfy Textures Widget](.ghassets/widget.png)

1. Select the actors you want to texture in the Outliner.

2. Set your desired settings in the Comfy Textures widget.

3. Click `Render` to start the rendering process.

Notes:
- Make sure your meshes have UVs (autogenerated UVs are fine).
- The plugin will automatically create a new material instance and texture for each selected actor.

## Modes

### Create

This mode uses a fast SDXL LCM model to create a low-resolution texture for each selected actor. Use this to quickly prototype and iterate on your scene.

### Refine

This mode uses a slower SDXL workflow to refine the low-resolution textures created in the `Create` mode. Use this to create the final high-resolution textures for your scene.

### Edit

This mode allows you to edit the textures created in the `Create` or `Refine` mode by using an inpainting workflow. Use this mode to fix any artifacts or errors in the textures.

You can select from two edit modes - `From Texture` and `From Object`. `From Texture` allows you to do precise edits by painting undesired areas to magenta (255, 0, 255, 255) using Mesh Paint. `From Object` will inpaint all selected actors.